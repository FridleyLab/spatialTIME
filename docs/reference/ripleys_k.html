<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate Ripley's K — ripleys_k • spatialTIME</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Ripley's K — ripleys_k"><meta property="og:description" content="ripleys_k() calculates the emperical Ripley's K measurement for the cell types specified by mnames in the mIF object. This
is very useful when exploring the spatial clustering of single cell types on TMA cores or ROI spots following proccessing
with a program such as HALO for cell phenotyping.
In the `ripleys_k` function, there is the ability to perform permutations in order to assess whether the clustering
of a cell type is significant, or the ability to derive the exact CSR and forgo permutations for much faster sample
processing. Permutations can be helpful if the significance of clustering wasnts to be identified - run 1000 permutations 
and if observed is outside 95-percentile then significant clustering. We, however, recommend using the exact CSR estimate
due to speed.
Some things to be aware of when computing the exact Ripley's K estimate, if your spatial file is greater than 
the `big` size, the edge correction will be converted to 'none' in order to save on resources and compute time. 
Due to the introduction of Whole Slide Imaging (WSI), this can easily be well over 1,000,000 cells, and calculating 
edge correction for these spatial files will not succeed when attempting to force an edge correction on it."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spatialTIME</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.4-1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/deriving_functions.html">Deriving Functions</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction to spatialTIME</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/FridleyLab/spatialTIME/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate Ripley's K</h1>
    <small class="dont-index">Source: <a href="https://github.com/FridleyLab/spatialTIME/blob/HEAD/R/ripleys_k.R" class="external-link"><code>R/ripleys_k.R</code></a></small>
    <div class="hidden name"><code>ripleys_k.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>ripleys_k() calculates the emperical Ripley's K measurement for the cell types specified by mnames in the mIF object. This
is very useful when exploring the spatial clustering of single cell types on TMA cores or ROI spots following proccessing
with a program such as HALO for cell phenotyping.</p>
<p>In the `ripleys_k` function, there is the ability to perform permutations in order to assess whether the clustering
of a cell type is significant, or the ability to derive the exact CSR and forgo permutations for much faster sample
processing. Permutations can be helpful if the significance of clustering wasnts to be identified - run 1000 permutations 
and if observed is outside 95-percentile then significant clustering. We, however, recommend using the exact CSR estimate
due to speed.</p>
<p>Some things to be aware of when computing the exact Ripley's K estimate, if your spatial file is greater than 
the `big` size, the edge correction will be converted to 'none' in order to save on resources and compute time. 
Due to the introduction of Whole Slide Imaging (WSI), this can easily be well over 1,000,000 cells, and calculating 
edge correction for these spatial files will not succeed when attempting to force an edge correction on it.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ripleys_k</span><span class="op">(</span></span>
<span>  <span class="va">mif</span>,</span>
<span>  <span class="va">mnames</span>,</span>
<span>  r_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  num_permutations <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  edge_correction <span class="op">=</span> <span class="st">"translation"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"K"</span>,</span>
<span>  permute <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  keep_permutation_distribution <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  xloc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  yloc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  big <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>mif</dt>
<dd><p>object of class `mif` created with `create_mif`</p></dd>


<dt>mnames</dt>
<dd><p>cell phenotype markers to calculate Ripley's K for</p></dd>


<dt>r_range</dt>
<dd><p>radius range (including 0)</p></dd>


<dt>num_permutations</dt>
<dd><p>number of permutations to use to estimate CSR. If `keep_perm_dis` is set to FALSE, this will be ignored</p></dd>


<dt>edge_correction</dt>
<dd><p>edge correction method to pass to `Kest`. can take one of "translation", "isotropic", "none"</p></dd>


<dt>method</dt>
<dd><p>not used currently</p></dd>


<dt>permute</dt>
<dd><p>whether to use CSR estimate or use permutations to determine CSR</p></dd>


<dt>keep_permutation_distribution</dt>
<dd><p>whether to find mean of permutation distribution or each
permutation calculation</p></dd>


<dt>workers</dt>
<dd><p>number of cores to use for calculations</p></dd>


<dt>overwrite</dt>
<dd><p>whether to overwrite the `univariate_Count` slot within `mif$derived`</p></dd>


<dt>xloc</dt>
<dd><p>the location of the center of cells. If left `NULL`, `XMin`, `XMax`, `YMin`, and `YMax` must be present.</p></dd>


<dt>yloc</dt>
<dd><p>the location of the center of cells. If left `NULL`, `XMin`, `XMax`, `YMin`, and `YMax` must be present.</p></dd>


<dt>big</dt>
<dd><p>the number of cells at which to flip from an edge correction method other than 'none' to 'none' due to size</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>object of class `mif`</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">spatialTIME</span><span class="fu">::</span><span class="fu"><a href="create_mif.html">create_mif</a></span><span class="op">(</span>clinical_data <span class="op">=</span><span class="fu">spatialTIME</span><span class="fu">::</span><span class="va"><a href="example_clinical.html">example_clinical</a></span> <span class="op"><a href="pipe.html">%&gt;%</a></span> </span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>deidentified_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">deidentified_id</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sample_data <span class="op">=</span> <span class="fu">spatialTIME</span><span class="fu">::</span><span class="va"><a href="example_summary.html">example_summary</a></span> <span class="op"><a href="pipe.html">%&gt;%</a></span> </span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>deidentified_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">deidentified_id</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  spatial_list <span class="op">=</span> <span class="fu">spatialTIME</span><span class="fu">::</span><span class="va"><a href="example_spatial.html">example_spatial</a></span>,</span></span>
<span class="r-in"><span>  patient_id <span class="op">=</span> <span class="st">"deidentified_id"</span>, </span></span>
<span class="r-in"><span>  sample_id <span class="op">=</span> <span class="st">"deidentified_sample"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mnames</span> <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">spatial</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Pos|CD"</span>, <span class="va">.</span>, value <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Cyto|Nucle"</span>, <span class="va">.</span>, value <span class="op">=</span><span class="cn">TRUE</span>, invert <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">=</span> <span class="fu">ripleys_k</span><span class="op">(</span>mif <span class="op">=</span> <span class="va">x</span>, </span></span>
<span class="r-in"><span>  mnames <span class="op">=</span> <span class="va">mnames</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>  r_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  num_permutations <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  edge_correction <span class="op">=</span> <span class="st">"translation"</span>, </span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"K"</span>, </span></span>
<span class="r-in"><span>  permute <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  keep_permutation_distribution <span class="op">=</span><span class="cn">FALSE</span>, </span></span>
<span class="r-in"><span>  workers <span class="op">=</span> <span class="fl">1</span>, </span></span>
<span class="r-in"><span>  overwrite <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(r)`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(r)`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(r)`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(r)`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(r)`</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jordan Creed, Ram Thapa, Christopher Wilson, Alex Soupir, Oscar Ospina, Julia Wrobel, Fridley Lab.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

