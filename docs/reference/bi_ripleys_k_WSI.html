<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Bivariate Ripley's K for Whole Slide Images — bi_ripleys_k_WSI • spatialTIME</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Bivariate Ripley's K for Whole Slide Images — bi_ripleys_k_WSI"><meta property="og:description" content="Bivariate Ripley's K function within spatialTIME, `bi_ripleys_k` is a function that takes in a `mIF` object, along with 
some parameters like marker names of interest and range of radii in which to assess bivariate clustering or colocalization.
In 1.3.3.3 we have introduced the ability to forsgo the need for permutations with the implementation of the exact CSR estimate.
This is both faster and being the exact CSR, produces an exact degree of clustering in the spatial files.
Due to the availability of whole slide images (WSI), there's a possibility users will be running bivariate Ripley's K on samples
that have millions of cells. When doing this, keep in mind that a nearest neighbor matrix with *n* cell is *n* by *n* in size and 
therefore easily consumers high performance compute levels of RAM. To combat this, we have implemented a tiling method that performs
counts for small chunks of the distance matrix at a time before finally calculating the bivariate Ripley's K value on the total counts.
When doing this there are now 2 import parameters to keep in mind. The `big` parameter is the size of the tile to use. We have found
1000 to be a good number that allows for high number of cores while maintaining low RAM usage. The other important parameter when
working with WSI is nlarge which is the fall over for switching to no edge correction. The spatstat.explore::Kest univariate 
Ripley's K uses a default of 3000 but we have defaulted to 1000 to keep compute minimized as edge correction uses large amounts
of RAM over 'none'."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spatialTIME</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/deriving_functions.html">Deriving Functions</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction to spatialTIME</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/FridleyLab/spatialTIME/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bivariate Ripley's K for Whole Slide Images</h1>
    <small class="dont-index">Source: <a href="https://github.com/FridleyLab/spatialTIME/blob/HEAD/R/bi_ripleys_k_WSI.R" class="external-link"><code>R/bi_ripleys_k_WSI.R</code></a></small>
    <div class="hidden name"><code>bi_ripleys_k_WSI.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Bivariate Ripley's K function within spatialTIME, `bi_ripleys_k` is a function that takes in a `mIF` object, along with 
some parameters like marker names of interest and range of radii in which to assess bivariate clustering or colocalization.
In 1.3.3.3 we have introduced the ability to forsgo the need for permutations with the implementation of the exact CSR estimate.
This is both faster and being the exact CSR, produces an exact degree of clustering in the spatial files.</p>
<p>Due to the availability of whole slide images (WSI), there's a possibility users will be running bivariate Ripley's K on samples
that have millions of cells. When doing this, keep in mind that a nearest neighbor matrix with *n* cell is *n* by *n* in size and 
therefore easily consumers high performance compute levels of RAM. To combat this, we have implemented a tiling method that performs
counts for small chunks of the distance matrix at a time before finally calculating the bivariate Ripley's K value on the total counts.
When doing this there are now 2 import parameters to keep in mind. The `big` parameter is the size of the tile to use. We have found
1000 to be a good number that allows for high number of cores while maintaining low RAM usage. The other important parameter when
working with WSI is nlarge which is the fall over for switching to no edge correction. The spatstat.explore::Kest univariate 
Ripley's K uses a default of 3000 but we have defaulted to 1000 to keep compute minimized as edge correction uses large amounts
of RAM over 'none'.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bi_ripleys_k_WSI</span><span class="op">(</span></span>
<span>  <span class="va">mif</span>,</span>
<span>  <span class="va">mnames</span>,</span>
<span>  r_range <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">100</span>,</span>
<span>  edge_correction <span class="op">=</span> <span class="st">"translation"</span>,</span>
<span>  num_permutations <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  permute <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  keep_permutation_distribution <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  big <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  nlarge <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  xloc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  yloc <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>mif</dt>
<dd><p>mIF object with spatial data frames, clinical, and per-sample summary information</p></dd>


<dt>mnames</dt>
<dd><p>vector of column names for phenotypes or data frame of marker combinations</p></dd>


<dt>r_range</dt>
<dd><p>vector range of radii to calculate co-localization *K*</p></dd>


<dt>edge_correction</dt>
<dd><p>character edge_correction method, one of "translation", or none"</p></dd>


<dt>num_permutations</dt>
<dd><p>integer number of permutations to estimate CSR</p></dd>


<dt>permute</dt>
<dd><p>whether or not to use permutations to estimate CSR (TRUE) or to calculate exact CSR (FALSE)</p></dd>


<dt>keep_permutation_distribution</dt>
<dd><p>boolean as to whether to summarise permutations to mean</p></dd>


<dt>overwrite</dt>
<dd><p>boolean as to whether to replace existing bivariate_Count if exists</p></dd>


<dt>workers</dt>
<dd><p>integer number of CPU workers to use</p></dd>


<dt>big</dt>
<dd><p>integer used as the threshold for subsetting large samples, default is 1000 either *i* or *j*</p></dd>


<dt>nlarge</dt>
<dd><p>number of cells in either *i* or *j* to flip to no edge correction - at small (relative to whole spatial region) *r* values differences in results between correction methods is negligible so running a few samples is recommended. Perhaps compute outweighs small differences in correction methods.</p></dd>


<dt>xloc</dt>
<dd><p>the x and y positions that correspond to cells. If left as NULL, XMin, XMax, YMin, and YMax must be present in the spatial files</p></dd>


<dt>yloc</dt>
<dd><p>the x and y positions that correspond to cells. If left as NULL, XMin, XMax, YMin, and YMax must be present in the spatial files</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>mif object with bivariate Ripley's K calculated</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">spatialTIME</span><span class="fu">::</span><span class="fu"><a href="create_mif.html">create_mif</a></span><span class="op">(</span>clinical_data <span class="op">=</span> <span class="fu">spatialTIME</span><span class="fu">::</span><span class="va"><a href="example_clinical.html">example_clinical</a></span> <span class="op"><a href="pipe.html">%&gt;%</a></span> </span></span>
<span class="r-in"><span>                               <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>deidentified_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">deidentified_id</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             sample_data <span class="op">=</span> <span class="fu">spatialTIME</span><span class="fu">::</span><span class="va"><a href="example_summary.html">example_summary</a></span> <span class="op"><a href="pipe.html">%&gt;%</a></span> </span></span>
<span class="r-in"><span>                               <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>deidentified_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">deidentified_id</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             spatial_list <span class="op">=</span> <span class="fu">spatialTIME</span><span class="fu">::</span><span class="va"><a href="example_spatial.html">example_spatial</a></span>,</span></span>
<span class="r-in"><span>                             patient_id <span class="op">=</span> <span class="st">"deidentified_id"</span>, </span></span>
<span class="r-in"><span>                             sample_id <span class="op">=</span> <span class="st">"deidentified_sample"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mnames_good</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD3..Opal.570..Positive"</span>,<span class="st">"CD8..Opal.520..Positive"</span>,</span></span>
<span class="r-in"><span>                 <span class="st">"FOXP3..Opal.620..Positive"</span>,<span class="st">"PDL1..Opal.540..Positive"</span>,</span></span>
<span class="r-in"><span>                 <span class="st">"PD1..Opal.650..Positive"</span>,<span class="st">"CD3..CD8."</span>,<span class="st">"CD3..FOXP3."</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">=</span> <span class="fu">bi_ripleys_k_WSI</span><span class="op">(</span>mif <span class="op">=</span> <span class="va">x</span>, mnames <span class="op">=</span> <span class="va">mnames_good</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>                   r_range <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">100</span>, edge_correction <span class="op">=</span> <span class="st">"none"</span>, permute <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                   num_permutations <span class="op">=</span> <span class="fl">50</span>, keep_permutation_distribution <span class="op">=</span> <span class="cn">FALSE</span>, </span></span>
<span class="r-in"><span>                   workers <span class="op">=</span> <span class="fl">1</span>, big <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jordan Creed, Ram Thapa, Christopher Wilson, Alex Soupir, Oscar Ospina, Julia Wrobel, Fridley Lab.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

