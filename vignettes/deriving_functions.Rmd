---
title: "Deriving Functions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Deriving Functions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This is going to be a short vignette for the use of the functions used to derive spatial metrics. 

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(tidyverse)
library(spatialTIME)
mif =  spatialTIME::create_mif(clinical_data = spatialTIME::example_clinical %>% 
                                 dplyr::mutate(deidentified_id = as.character(deidentified_id)),
                               sample_data = spatialTIME::example_summary %>% 
                                 dplyr::mutate(deidentified_id = as.character(deidentified_id)),
                               spatial_list = spatialTIME::example_spatial,
                               patient_id = "deidentified_id", 
                               sample_id = "deidentified_sample")

markers = colnames(mif$spatial[[1]]) %>% grep("CD3|Pos", ., value = T) %>% grep("Cyto|Nucle", ., value = T, invert = T)
markers = markers[c(1,2,4,5,8)]
```

## Ripley's K

### Univariate

```{r}
mif = ripleys_k(mif = mif,
                mnames = markers, 
                r_range = 0:100, 
                num_permutations = 50,
                edge_correction = 'translation', 
                permute = TRUE, 
                keep_permutation_distribution = FALSE, 
                workers = 5, 
                overwrite = TRUE, 
                xloc = NULL, 
                yloc = NULL)
```

